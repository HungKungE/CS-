

구조 : 응용프로그램(nodejs, php...) <-> DBMS <-> 데이터베이스


1. 데이터베이스 기본 정의

- 데이터베이스 : 일정한 규칙으로 구조화되어 저장되는 데이터의 모음
- DBMS : 데이터베이스 제어, 관리하는 통합 시스템 ( 쿼리를 사용하여 삽입 삭제 수정 조회 )
- 구조 : 응용프로그램(nodejs, php...) <-> DBMS <-> 데이터베이스

- entity : 어떤 객체의 속성을 지닌 명사 ( 회원 - 이름, 아이디, 주소, 전화번호 등.. )
    - 강한 entity : entity의 원소를 식별할 고유 key를 가진 entity
    - 약한 entity : 다른 entity로부터 entity의 원소를 식별할 고유 key를 받아오는 entity

- relation : 데이터베이스에서 정보를 구분하여 저장하는 기본 단위
    - RDBS : table
    - NoSQL : collection

- DB 별 구조 ( 1 - 2 - 3 : 1이 모여서 2, 2가 모여서 3)
    - RDBS : record - table - database
    - NoSQL : document - collection - database

- 속성 : relation에서 관리하는 고유한 이름을 가지는 정보
    - ex) user_info table의 user_id, email 등

- 도메인 : 속성들이 가질 수 있는 값의 집합
    - ex) 성별 속성 : {남, 여, 무응답}

- 필드 : 컬럼을 의미함. ( type을 가짐 )

2. 필드의 type

- 숫자 타입
    - TinyInt : 1 byte , (-128 ~ 127)
    - SmallInt : 2 byte, (-32768 ~ 32767)
    - MediumInt
    - Int
    - BigInt

- 날짜 타입
    - Date : only 날짜, 1000.01.01 ~ 9999.12.31
    - DateTime : 날짜 + 시간, 1000.01.01. 00:00:00 ~ 9999.12.31. 23:59:59
    - TimeStamp :날짜 + 시간, 1970.01.01. 00:00:01 ~ 2038.01.19. 03:14:07

- 문자 타입
    - 일반 문자열
        - Char : 고정 길이, 0 ~ 255, 무조건 선언 길이만큼 저장 ( 나머지는 공백으로 저장됨 )
        - Varchar : 가변 길이, 0 ~ 65,535, 실제 입력된 값만큼 저장
    - 큰 문자열
        - TEXT : 큰 문자열 저장할 때 사용함 ( 게시판 내용 )
        - BLOB : 이미지, 동영상 등 큰 데이터 저장 -> 보통 aws s3에 파일을 저장하고, 해당 경로를 varchar로 저장함
    - 열거형 : 공간적 이득, 어떤 서비스 수정 시에 코드에서 모든 값들을 수정해야함
        - ENUM : 최대 65535개의 요소 설정 가능, 리스트에 없는 값 삽입 시 빈 문자열 삽입
        - SET : 여러 데이터 선택 가능, 비트 단위 연산, 64개의 요소 설정 가능

3. 관계

- 1:1 관계
    - ex) USER_INFO {user_id, 아이디, 비번},  USER_EMAIL {user_id, 이메일}
- 1:N 관계
    - ex) USER_INFO {user_id, 아이디, 비번}, USER_ARTICLE {user_id, text, like..}
- N:M 관계
    - ex) STUDENT {stu_id, name, phone}, LECTURE {lec_id, title, professer}
    - 이 경우에는 중간에 테이블을 하나 더 만들어서 1:N , 1:M 관계를 가지게 한다.
    - ex) STRDENT {stu_id, name, phone}, LECTURE {lec_id, title, professer}, STU_LEC {stu_id, lec_id}

4. Key
- key의 속성
```sh
  유일성 : 중복되는 값이 없다. ( unique )
  최소성 : 최소필드로 키를 형성할 수 있다.
```

- key 종류
    - 기본키 ( primary key ) : 유일성과 최소성을 만족하는 key
    - 외래키 ( foreign key ) : 다른 table의 기본키를 참조하는 key
    - 후보키 : 기본키 후보들,  유일성과 최소성을 만족함
    - 대체키 : 후보키 중에서 기본키 이외의 키
    - 슈퍼키 : 각 레코드를 유일하게 식별할 수 있는 유일성을 갖춘 키

5. ERD와 정규화

- ERD : 데이터베이스 설계에서 가장 기초적인 뼈대 역할을 하는 관계를 정의한 것.
- 정규화 : 각 entity 사이의 잘못된 종속 관계로 인해 발생하는 이상 현상(데이터 중복, 중요 데이터 삭제, 필드값 에러로 삽입 실패 등)이나,
        저장 공간을 효율적으로 사용하기 위해 table을 여러 개로 분리하는 과정.
    - 기본 정규형
        - 제1정규형 : 하나의 컬럼에는 하나의 정보만 저장한다.
        - 제2정규형 : 쓸데없이 중복되는 데이터가 없게 한다.
        - 제3정규형 : 기본키를 제외한 컬럼이 서로 연관이 없는 정보여야 한다.
        - 보이스/레코드 정규형
    - 고급 정규형
        - 제4정규형
        - 제5정규형
    
- 정규형 원칙 : 같은 의미를 표현해도 더 좋은 구조로 만들거나, 자료의 중복성이 감소하거나, 독립적인 관계는 별도의 table로 표현해야 하고
               각각의 table은 독립적인 표현이 가능해야 한다.


6. 트랜젝션과 무결성

- 트랜젝션 : 데이터베이스에서 하나의 논리적 기능을 수행하기 위한 작업의 단위
- 트랜젝션의 특징 ( 원자성 : ACID )
    - 원자성 : 트랜젝션 수행 도중에 문제가 발생한다면 트랜젝션 전체가 수행되지 않음을 보장한다.
    - 일관성 : 허용된 방식으로만 데이터를 변경해야한다 -> 데이터의 도메인에 해당하는 값만 사용한다.
    - 격리성 : 트랜젝션 수행 시 서로 끼어들지 못한다.
    - 지속성 : 성공적으로 커밋된 트랜젝션의 결과는 영원히 반영되어야 한다. -> 시스템 장애가 발생해도 원래 상태로 복구하는 회복 기능이 있어야 한다.

- 무결성 : 데이터의 정확성, 일관성, 유효성을 유지하는 것.
    - 개체 무결성 : 기본키는 빈값을 허용하지 않는다.
    - 참조 무결성 : 참조 관계의 테이블의 데이터는 항상 일관된 값을 유지한다.
    - 고유 무결성 : 특정 속성에 대해 고유한 값을 가지도록 조건이 주어진 경우 그 속성 값은 모두 고유한 값을 가진다.
    - NULL 무결성 : 특정 속성 값에 NULL이 올 수 없다는 조건이 주어진 경우 그 속성 값은 NULL이 될수 없다는 제약 조건.


7. 데이터베이스의 종류

- 관계형 데이터베이스 (RDBMS)
    - 정의 : 행과 열을 가지는 표 형식 데이터를 저장하는 형태의 데이터베이스
    - 예시 : MySQL, PostgreSQL, Oracle

- NoSQL
    - 정의 : SQL을 사용하지 않는 데이터베이스
    - 예시 : MongoDB, Redis


8. 인덱스

- 필요성 : 찾고자 하는 정보를 빠르게 찾을 수 있다.
- B-tree : 인덱스는 보통 B-tree로 이루어져있다.
- 효율적인 이유
    - 모든 요소에 효율적으로 접근할 수 있는 균형잡힌 트리구조와 대수확장성 때문이다.
    - 대수 확장성 : 트리 깊이가 리프 노드 수에 비해 매우 느리게 성장하는 것

9. 조인

- 정의 : 2개 이상의 테이블을 묶어서 하나의 결과물을 만드는 것
- 종류
    - inner join : 테이블의 교집합
    - full outer join : 테이블의 합집합
    - left/right outer join : 각각 왼쪽.오른쪽 테이블의 모든행과 교집합이 결과에 표기

-원리
    - 중첩 로프 조인 : 테이블A의 한 행에 대해서 테이블B의 모든 행을 확인하여 조건에 맞는 레코드를 찾아 결과를 반환한다.
    - 정렬 병합 조인 : 각각의 테이블을 조인할 테이블 기준으로 정렬 -> 이후에 조인
        - 이럴 때 사용함 : 적절한 인덱스가 없다 / 대용량 테이블 조인 / 조건으로 비교 연산자(>,<) 사용
    - 해시 조인 : 해시 테이블을 이용한 조인
        - 이럴 대 사용함 :하나의 테이블이 메모리에 들어감. 동등 조건(=)에서만 사용